<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta name="Title" content="Man page for the nagios plugin check_avaya_trunks" />
  <meta name="Description" content="nagios plugin manual page for the nagios plugin check_avaya_trunks" />
  <meta name="Keywords" content="nagios, monitoring, Avaya, PBX, VOIP" />
  <meta name="Classification" content="Nagios plugin manual" />
  <title>Man page for the nagios plugin check_avaya_trunks</title>
</head>

<body>
<div id="wrapper">
  <div id="banner">
    <h1>check_avaya_trunks</h1>
    <h2>Man page for the Nagios plugin check_avaya_trunks</h2>
  </div>
  <div id="content">
  <div id=copyright>Copyright (c) 2010 Frank4DD <support[at]frank4dd.com></div>
  <h3 id=intro>check_avaya_trunks.pl</h3>
  <hr />
<p>
This plugin checks the call usage of PBX trunks on AVAYA VOIP S8xxx media servers, accessing Avaya's SNMP agent running with <a href="avaya/g3mib.asn1">G3-AVAYA-MIB Version 5.1.1</a>.
It returns the current number of active trunk lines compared to the total number of lines. They are checked against warning and critical threshold values to identify capacity issues. The data can be graphed for historical trending.<br />
Nagios checks are typically run in 5 minute intervals. Much could happen in between checks, fo example when a lot of short calls are being made. AVAYA's SNMP data provides a different data set with absolute call peaks across all trunks,  check_avaya_peaks is the plugin to monitor these.
</p>
<p>
This plugin requires SNMP access to the Avaya media server, which is configured in the management console.
Fo SNMP queries it depends on Perl's Net::SNMP package, i.e. perl-SNMP-5.3.0.1-25.34.1.
</p>
<h3 id=usage>Usage:</h3>
<hr />
<p>
check_avaya_trunk.pl [-v] -H &lt;host&gt; -C &lt;snmp_community&gt; [-2] | (-l login -x passwd [-X pass -L &lt;authp&gt;,&lt;privp&gt;])  [-p &lt;port&gt;] -T &lt;trunkgroup number&gt; -w &lt;warn level&gt; -c &lt;crit level&gt; [-t &lt;timeout&gt;] [-V]
</p>
<h3 id=options>Options:</h3>
<hr />
<p>
-v, --verbose<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print extra debugging information 
</p>
<p>
-h, --help<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print this help message
</p>
<p>
-H, --hostname=HOST<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name or IP address of host to check
</p>
<p>
-C, --community=COMMUNITY NAME<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; community name for the host's SNMP agent (implies v1 protocol)
</p>
<p>
-2, --v2c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Use snmp v2c
</p>
<p>
-l, --login=LOGIN ; -x, --passwd=PASSWD<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Login and auth password for snmpv3 authentication<br> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If no priv password exists, implies AuthNoPriv 
</p>
<p>
-X, --privpass=PASSWD<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Priv password for snmpv3 (AuthPriv protocol)
</p>
<p>
-L, --protocols=&lt;authproto&gt;,&lt;privproto&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;authproto&gt; : Authentication protocol (md5|sha : default md5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;privproto&gt; : Priv protocole (des|aes : default des) 
</p>
<p>
-p, --port=PORT<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SNMP port (Default 161)
</p>
<p>
-w, --warn=INTEGER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; warning number of active calls
</p>
<p>
-c, --crit=INTEGER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; critical number of active calls
</p>
<p>
-T, --trunkgroup<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the PBX trunk group number (TGN) to check for 
</p>
<p>
-t, --timeout=INTEGER<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timeout for SNMP in seconds (Default: 5)
</p>
<p>
-V, --version<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prints version number
</p>
<h3 id=plugindefinition>Plugin Definition Example:</h3>
<hr />
<p>
Below is an example of the plugin definition in the Nagios command.cfg file.
</p>
<pre><code># check_avaya_trunk nagios plugin
define command{
  command_name check_avaya_trunk
  command_line /srv/app/nagios/libexec/check_avaya_trunk.pl -H $HOSTADDRESS$ 
-t 60 -C $ARG1$ -f -w $ARG2$ -c $ARG3$
}</code></pre>
<p></p>
<h3 id=pluginexample>Plugin Usage Example:</h3>
<hr />
<p>
The plugin with its most basic use.
</p>
<pre class=code>susie: ~ # cd /srv/app/nagios/libexec
susie: ~ # ./check_avaya_trunks.pl -H 192.168.65.11 -C NBNro -T 1 -w 40 -c 46
Avaya Trunk TGN 1 - 8 of 46 channels active: OK</pre>
<p>
Avaya media servers can be very slooow in responding to SNMP requests. Especially the smaller systems like the S8300 series. here is a example query timed, it took over one minute to walk and calculate. Please use it with care, lets push Avaya for more direct retrievable SNMP data that does not require these extensive MIB walks.</p>
<pre class=code>susie: ~ # time ./check_avaya_trunks.pl -H 192.168.230.16 -C NBNro -2 -T 1 -w 55 -c 66 -v -t 15
SNMP v2c login
Trunk 1: TGN 1, 23 channels, 0 active.
Trunk 1: TGN 1 23 channels, 0 active.
Avaya system 192.168.230.16 has 1 trunks with 0/23 active channels.
Avaya Trunk TGN 1 - 0 of 23 channels active: OK

<b>real	1m18.864s</b></pre>
    <p></p>
</div>
</body></html>
