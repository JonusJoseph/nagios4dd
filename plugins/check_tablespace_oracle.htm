<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta name="Title" content="Man page for the nagios plugin check_tablespace_oracle" />
  <meta name="Description" content="nagios plugin manual page for the nagios plugin check_tablespace_oracle" />
  <meta name="Keywords" content="nagios, monitoring, oracle, version" />
  <meta name="Classification" content="Nagios plugin manual" />
  <title>Man page for the nagios plugin check_tablespace_oracle</title>
</head>

<body>
<div id="wrapper">
  <div id="banner">
    <h1>check_tablespace_oracle</h1>
    <h2>Man page for the Nagios plugin check_tablespace_oracle</h2>
  </div>
  <div id="content">
  <div id=copyright>Copyright (c) 2010 Frank4DD <support[at]frank4dd.com></div>
  <h3 id=intro>check_tablespace_oracle</h3>
  <hr>
<p>
This plugin checks the tablespace size of a specific Oracle database against WARN and CRIT thresholds.
It returns the total tablespace size, current size, space utilisation in percent and the number of
data files belonging to this tablespace. The plugin can be called in 'reporting' mode, returning the
space values withouth checking against a threshold. This is helpful if the tablespace only needs to be
graphed as a trend over time.
</p>
<p>
It requires the database to be set up for accepting network connections and being reachable
through that network port from Nagios. The plugin uses Oracle's JDBC driver, this driver
must be installed and found through the Java classpath on the server executing this plugin.
<a href=http://fm4dd.com/database/howto-install-Oracle-jdbc.htm>(JDBC installation example)</a>
</p>
<h4 id=usage>Usage:</h4>
<p>
java -classpath &lt;path to check_tablespace_oracle.class&gt; check_tablespace_oracle &lt;db-ip&gt; &lt;db-port&gt; &lt;db-instance&gt; &lt;db-user&gt; &lt;db-pwd&gt; [-d]
</p>
<p>
java -classpath &lt;path to check_tablespace_oracle.class&gt; check_tablespace_oracle &lt;db-ip&gt; &lt;db-port&gt; &lt;db-instance&gt; &lt;db-user&gt; &lt;db-pwd&gt; -r &lt;tablespace-name&gt;
</p>
<p>
java -classpath &lt;path to check_tablespace_oracle.class&gt; check_tablespace_oracle &lt;db-ip&gt; &lt;db-port&gt; &lt;db-instance&gt; &lt;db-user&gt; &lt;db-pwd&gt; &lt;tablespace-name&gt; &lt;KB-warn&gt; &lt;KB-crit&gt;
</p>
<h4 id=options>Options:</h4>
<p>
&lt;db-ip&gt; <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The IP address of the database server </p><p>
&lt;db-port&gt; <br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The database network port, Oracle typically uses tcp port 1521 </p><p>
&lt;db-instance&gt; <br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The database instance name  </p><p>
&lt;db-user&gt; <br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The database user required for database login </p><p>
&lt;db-pwd&gt; <br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The password of the database user. It can be enclosed in double-quotes to to accept special characters such as ; </p><p>
-d <br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Enable debugging output, lists all available tablespaces</p><p>
-r &lt;tablespace&gt;<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Reporting tablespace size, always returns OK</p><p>
&lt;tablespace&gt; &lt;KB-warn&gt; &lt;KB-crit&gt; <br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set tablesapce name and alert thresholds for WARN and CRIT in Kbytes
<h4 id=pluginexample>Plugin Usage Example:</h4>
<p>
The plugin in 'reporting' mode, returns OK if the tablespace size could be fetched.
<pre class=code># java -classpath /srv/app/nagios/libexec/ check_tablespace_oracle 192.168.98.151
 1521  ORADB system "p@ssw0rd" -r G02IND01
Tablespace OK: G02IND01 20% used|G02IND01: 3 datafiles, used 5120 KB of 9216 KB total</pre>
</p>
<p>
The plugin in 'check' mode, returns the status depending on the tablespace size exceeding the WARN and CRIT threshold values.
<pre class=code># java -classpath /srv/app/nagios/libexec/ check_tablespace_oracle 192.168.98.151
 1521  ORADB system "p@ssw0rd" G02IND01 5120 5121
Tablespace WARN: G02IND01 20% used|G02IND01: 3 datafiles, used 5120 KB of 9216 KB total</pre>
  </p>
  <p>
The plugin in 'debug' mode, listing all tablespaces configured for this database.
<pre class=code># java -classpath /srv/app/nagios/libexec/ check_tablespace_oracle 192.168.1.151
 1521  ORADB system "p@ssw0rd" -d
DB connect: jdbc:oracle:thin:system/p@ssw0rd@1192.168.1.151:1521:ORADB
DB query: select  df.TABLESPACE_NAME, df.FILE_ID, ((df.BYTES+fs.BYTES)/1024)
 kbytes_max, (df.BYTES/1024) kbytes_used, round(((df.BYTES - fs.BYTES) /
 df.BYTES) * 100) usage_pct from ( select  TABLESPACE_NAME, sum(BYTES) 
BYTES, count(distinct FILE_ID) FILE_ID from dba_data_files group by 
TABLESPACE_NAME ) df, ( select TABLESPACE_NAME, sum(BYTES) BYTES from 
dba_free_space group by TABLESPACE_NAME) fs where df.TABLESPACE_NAME=
fs.TABLESPACE_NAME order by df.TABLESPACE_NAME asc
Name:             G02IND01 Files:  3 Space total:       9216 KB Space used:       5120 KB Space % used:  20 %
Name:             G02IND02 Files:  3 Space total:       9280 KB Space used:       5120 KB Space % used:  19 %
Name:             G02IND03 Files:  3 Space total:       9280 KB Space used:       5120 KB Space % used:  19 %
Name:             G02IND04 Files:  3 Space total:       9280 KB Space used:       5120 KB Space % used:  19 %
Name:             G02IND05 Files:  3 Space total:       9216 KB Space used:       5120 KB Space % used:  20 %
Name:             G02IND06 Files:  3 Space total:       9216 KB Space used:       5120 KB Space % used:  20 %
Name:             G02IND07 Files:  3 Space total:       9216 KB Space used:       5120 KB Space % used:  20 %
Name:             G02IND08 Files:  3 Space total:       9088 KB Space used:       5120 KB Space % used:  23 %
Name:             G02IND09 Files:  2 Space total:      39552 KB Space used:      20480 KB Space % used:   7 %
Name:             G02TAB01 Files:  1 Space total:       8960 KB Space used:       5120 KB Space % used:  25 %</pre>
  <h4 id=notes>Notes:</h4>
  <p>
  The plugin's .java source code file needs to be compiled into Java bytecode before it can be used, i.e. by calling:<br>
  <i>javac check_tablespace_oracle.java</i>.
  </p>
</div>
</body></html>
