<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta name="Title" content="Man page for the nagios plugin check_asa_sessions.sh" />
  <meta name="Description" content="nagios plugin manual page for the nagios plugin check_asa_sessions.sh" />
  <meta name="Keywords" content="nagios, monitoring, asa_sessions.sh, brute-force" />
  <meta name="Classification" content="Nagios plugin manual" />
  <title>Man page for the nagios plugin check_asa_sessions.sh</title>
</head>

<body>
<div id="wrapper">
  <div id="banner">
    <h1>check_asa_sessions.sh</h1>
    <h2>Man page for the Nagios plugin check_asa_sessions.sh</h2>
  </div>
  <div id="content">
  <div id=copyright>Copyright (c) 2015 Frank4DD <support[at]frank4dd.com></div>
  <h3 id=intro>check_asa_sessions.sh</h3>
  <hr />
<p>
This plugin checks the number of VPN sessions on Cisco ASA appliances (e.g. 5525). This can be used to monitor the VPN usage over time, and pro-actively manage VPN license and device load. Thanks to Cisco's detailled SNMP MIB, we can monitor separately for IPsec, SSL-VPN and clientless WebVPN sessions. The plugin has a switch to count data over a redundand, load-sharing VPN cluster.
</p>
<h3 id=usage>Usage:</h3>
  <hr />
<p>
./check_asa_sessions.sh -H &lt;hostname&gt; -C &lt;community&gt; -T &lt;type&gt; -w &lt;warning-value&gt; -c &lt;critical-value&gt; [-u &lt;cluster-IP&gt;] | -h
</p>

<h3 id=options>Options:</h3>
  <hr />
<p>
-H, --hostname<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Hostname (required)</p><p>
-C, --community<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SNMP Community (required)</p><p>
-T, --type <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ipsec | sslvpn | webvpn | rasvpn</p><p>
-u, --cluster<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add the IP addresses of the remaining VPN cluster members. This option will count the sessions over all members and return the summary</p><p>
-w <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The total number of blocked IP considered for warning </p><p>
-c <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The total number of blocked IP considered critical</p><p>
-t, --timeout<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The SNMP timeout value in seconds (defaults to 15)</p><p>
-h <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Displays the plugin usage</p><p>
</p>

<h3 id=pluginexample>Plugin Usage Example:</h3>
  <hr />
<p>Commandline output:</p>
<p>
<pre class=code># /srv/app/nagios/lib/check_asa_sessions.pl -H 192.168.10.31 -C NAGro -t sslvpn -w 40 -c 80
OK: 39 Cisco ASA sslvpn sessions</pre>
</p>
<p>
<p>Nagios plugin call definition in commands.cfg:</p>
<pre><code>define command{
  command_name check_asa_sessions
  command_line $USER1$/check_asa_sessions.sh -H $HOSTNAME$ -C $ARG1$ -t $ARG2$ -w $ARG3$ -c $ARG4$
}</code></pre>
</p>
<p>Nagios plugin service definition, e.g. security-services.cfg:</p>
<pre><code>#######################################################################
# Check ASA VPN sessions
#######################################################################
define service {
  use                           generic-security
  host_name                     susie
  service_description           sslvpn-sessions
  check_command                 check_asa_sessions!NAGro!sslvpn!40!80
}</code></pre>
</p>

<p>Nagios Output:</p>
<p>Exemplary output for a VPN cluster, providing both SSL-VPN (Anyconnect) and clientless Web-VPN access. </p>
<p><img src="images/check_asa_sessions-example1.png"></p>

<p>Nagios Graph:</p>
<p>Visualizing the number of concurrent VPN sessions gives a good indication about remote user activity, and helps track VPN uage, sizing, Cisco ASA VPN hardware and license limits.</p>
<p><img src="images/check_asa_sessions-example2.png"></p>
</div>
</body></html>

